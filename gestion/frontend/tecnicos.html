<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Admin Dashboard – Casa Antoñito</title>
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #3f51b5;
            --primary-dark: #303f9f;
            --bg-light: #f4f6fa;
            --bg-dark: #263238;
            --text-light: #ffffff;
            --text-dark: #212121;
        }

        body {
            background: var(--bg-light);
            color: var(--text-dark);
            font-family: 'Segoe UI', sans-serif;
        }

        .sidebar {
            width: 260px;
            height: 100vh;
            position: fixed;
            background: var(--primary-dark);
            color: var(--text-light);
            display: flex;
            flex-direction: column;
            padding: 1.5rem;
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            border-top-right-radius: 1rem;
            border-bottom-right-radius: 1rem;
        }

        .sidebar a.nav-link {
            color: var(--text-light);
            padding: 0.75rem 1rem;
            border-radius: 8px;
            transition: background 0.2s ease;
            font-size: 0.95rem;
        }

        .sidebar a.nav-link.active,
        .sidebar a.nav-link:hover {
            background: rgba(255, 255, 255, 0.15);
            font-weight: 600;
        }

        .sidebar i {
            font-size: 1.2rem;
            margin-right: 10px;
        }

        .sidebar hr {
            border-color: rgba(255, 255, 255, 0.1);
        }

        .sidebar .logo {
            display: flex;
            align-items: center;
            margin-bottom: 2rem;
        }

        .sidebar .logo img {
            width: 40px;
            height: 40px;
            margin-right: 10px;
            border-radius: 50%;
            border: 2px solid #fff;
        }

        .sidebar .profile {
            margin-top: auto;
        }

        .sidebar .profile a {
            display: flex;
            align-items: center;
            text-decoration: none;
            color: var(--text-light);
        }

        .sidebar .profile img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid #fff;
            margin-right: 10px;
        }

        .content {
            margin-left: 260px;
            padding: 2rem;
        }

        footer {
            background: #fff;
            padding: 1rem 2rem;
            border-top: 1px solid #ddd;
            position: fixed;
            bottom: 0;
            left: 260px;
            width: calc(100% - 260px);
            font-size: 0.85rem;
            color: #888;
        }

        .nav-section-title {
            font-size: 0.8rem;
            text-transform: uppercase;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            padding-left: 1rem;
            color: #bbb;
        }

        .badge {
            background-color: #ff4081;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 12px;
            margin-left: auto;
        }
    </style>

    <!-- Sidebar -->
    <nav class="sidebar">
        <div class="logo">
            <img src="img/logo.jpg" alt="Logo">
            <span class="fs-5 fw-bold">TechnoApp</span>
        </div>

        <hr>

        <div class="nav-section-title">Navegación</div>
        <ul class="nav nav-pills flex-column mb-auto">
            <li class="nav-item mb-1">
                <a href="index.html" class="nav-link active d-flex align-items-center">
                    <i class='bx bxs-dashboard'></i> Dashboard
                </a>
            </li>
            <li class="nav-item mb-1">
                <a href="index.html" class="nav-link d-flex align-items-center">
                    <i class='bx bx-plus-medical'></i> Registrar Asistencia
                    <span class="badge">+3</span>
                </a>
            </li>
        </ul>

        <div class="nav-section-title">Gestión</div>
        <ul class="nav nav-pills flex-column mb-3">
            <li class="nav-item mb-1">
                <a href="tecnicos.html" class="nav-link d-flex align-items-center">
                    <i class='bx bxs-user-detail'></i> Técnicos
                </a>
            </li>
            <li class="nav-item mb-1">
                <a href="empresas.html" class="nav-link d-flex align-items-center">
                    <i class='bx bxs-building'></i> Empresas
                </a>
            </li>
        </ul>

        <hr>

        <!-- Perfil -->
        <div class="profile mt-auto">
            <a href="#" data-bs-toggle="dropdown">
                <img src="https://via.placeholder.com/40" alt="perfil">
                <span class="fw-semibold">Eduardo</span>
            </a>
            <ul class="dropdown-menu dropdown-menu-dark shadow-sm mt-2">
                <li><a class="dropdown-item" href="#">Perfil</a></li>
                <li><a class="dropdown-item" href="#">Cerrar sesión</a></li>
            </ul>
        </div>
    </nav>



    <!-- Main content -->
    <div class="content">
        <nav class="navbar navbar-light bg-white mb-4 shadow-sm">
            <div class="container-fluid">
                <span class="navbar-brand mb-0 h1">Dashboard de Asistencia Tecnica</span>
            </div>
        </nav>

        <!-- Dashboard cards -->
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="card text-white bg-primary shadow rounded-4">
                    <div class="card-body d-flex align-items-center">
                        <div class="me-3">
                            <i class="fas fa-calendar-check fa-2x"></i>
                        </div>
                        <div>
                            <h5 class="card-title mb-1">Asistencias hoy</h5>
                            <p id="asistenciasHoy" class="card-text fs-4 fw-bold">0</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-white bg-success shadow rounded-4">
                    <div class="card-body d-flex align-items-center">
                        <div class="me-3">
                            <i class="fas fa-user-cog fa-2x"></i>
                        </div>
                        <div>
                            <h5 class="card-title mb-1">Técnicos activos</h5>
                            <p id="tecnicosActivos" class="card-text fs-4 fw-bold">0</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-white bg-warning shadow rounded-4">
                    <div class="card-body d-flex align-items-center">
                        <div class="me-3">
                            <i class="fas fa-building fa-2x"></i>
                        </div>
                        <div>
                            <h5 class="card-title mb-1">Empresas</h5>
                            <p id="empresasTotales" class="card-text fs-4 fw-bold">0</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <!-- Formulario para Técnicos -->
        <div class="mt-4">
            <div class="card">
                <div class="card-header bg-primary text-white fw-semibold">Registrar Técnico</div>
                <div class="card-body">
                    <form id="formTecnico">
                        <div class="mb-3">
                            <label for="nombreTecnico" class="form-label">Nombre</label>
                            <input type="text" id="nombreTecnico" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label for="apellidoTecnico" class="form-label">Apellido</label>
                            <input type="text" id="apellidoTecnico" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label for="correoTecnico" class="form-label">Correo electrónico</label>
                            <input type="email" id="correoTecnico" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label for="telefonoTecnico" class="form-label">Teléfono</label>
                            <input type="text" id="telefonoTecnico" class="form-control" required>
                        </div>
                        <div class="d-grid">
                            <button type="submit" class="btn btn-success">
                                <i class='bx bx-user-plus'></i> Registrar Técnico
                            </button>
                        </div>
                        <p id="mensajeTecnico" class="mt-3"></p>
                    </form>
                </div>
            </div>
        </div>

        <!-- Tabla de Técnicos -->
        <div class="mt-4">
            <div class="card">
                <div class="card-header bg-dark text-white fw-semibold">Lista de Técnicos</div>
                <div class="card-body table-responsive">
                    <table class="table table-hover table-bordered align-middle">
                        <thead class="table-light">
                        <tr>
                            <th>#</th>
                            <th contenteditable="false">Nombre</th>
                            <th contenteditable="false">Apellido</th>
                            <th contenteditable="false">Correo</th>
                            <th contenteditable="false">Teléfono</th>
                            <th>Acciones</th>
                        </tr>
                        </thead>
                        <tbody id="tablaTecnicos"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <script>
            const apiBase = 'http://localhost:8080/api';

            async function cargarTecnicos() {
                try {
                    const res = await fetch(`${apiBase}/clientes`);
                    const data = await res.json();
                    const tbody = document.getElementById("tablaTecnicos");
                    tbody.innerHTML = "";

                    data.forEach((t, index) => {
                        const tr = document.createElement("tr");
                        tr.innerHTML = `
                    <td>${index + 1}</td>
                    <td contenteditable="true" class="editable" data-campo="nombre" data-id="${t.id}">${t.nombre}</td>
                    <td contenteditable="true" class="editable" data-campo="apellido" data-id="${t.id}">${t.apellido}</td>
                    <td contenteditable="true" class="editable" data-campo="correo" data-id="${t.id}">${t.correo}</td>
                    <td contenteditable="true" class="editable" data-campo="telefono" data-id="${t.id}">${t.telefono}</td>
                    <td>
                        <button class="btn btn-sm btn-success" onclick="guardarTecnico(${t.id}, this)">
                            <i class="fa fa-save"></i> Guardar
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="eliminarTecnico(${t.id})">
                            <i class="fa fa-trash"></i> Eliminar
                        </button>
                    </td>
                `;
                        tbody.appendChild(tr);
                    });
                } catch (error) {
                    console.error("❌ Error al cargar técnicos:", error);
                }
            }

            document.getElementById("formTecnico").addEventListener("submit", async (e) => {
                e.preventDefault();
                const mensaje = document.getElementById("mensajeTecnico");

                const payload = {
                    nombre: nombreTecnico.value.trim(),
                    apellido: apellidoTecnico.value.trim(),
                    correo: correoTecnico.value.trim(),
                    telefono: telefonoTecnico.value.trim()
                };

                try {
                    const res = await fetch(`${apiBase}/clientes`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(payload)
                    });

                    if (res.ok) {
                        mensaje.textContent = "✅ Técnico registrado con éxito.";
                        mensaje.className = "text-success fw-bold";
                        document.getElementById("formTecnico").reset();
                        cargarTecnicos();
                    } else {
                        const err = await res.json();
                        mensaje.textContent = `❌ Error: ${err.message || "Ocurrió un problema"}`;
                        mensaje.className = "text-danger fw-bold";
                    }
                } catch (error) {
                    mensaje.textContent = "❌ Error al conectar con el servidor.";
                    mensaje.className = "text-danger fw-bold";
                }
            });

            async function guardarTecnico(id, boton) {
                const row = boton.closest("tr");
                const celdas = row.querySelectorAll(".editable");

                const payload = {};
                celdas.forEach(celda => {
                    const campo = celda.getAttribute("data-campo");
                    payload[campo] = celda.textContent.trim();
                });

                try {
                    const res = await fetch(`${apiBase}/clientes/${id}`, {
                        method: "PUT",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(payload)
                    });

                    if (res.ok) {
                        alert("✅ Técnico actualizado correctamente.");
                        cargarTecnicos();
                    } else {
                        alert("❌ Error al actualizar técnico.");
                    }
                } catch (error) {
                    console.error("❌ Error al actualizar técnico:", error);
                }
            }

            async function eliminarTecnico(id) {
                if (!confirm("¿Deseas eliminar este técnico?")) return;

                try {
                    const res = await fetch(`${apiBase}/clientes/${id}`, {
                        method: "DELETE"
                    });

                    if (res.ok) {
                        alert("✅ Técnico eliminado.");
                        cargarTecnicos();
                    } else {
                        alert("❌ Error al eliminar técnico.");
                    }
                } catch (error) {
                    console.error("❌ Error al eliminar técnico:", error);
                }
            }

            // Al cargar la página
            cargarTecnicos();
        </script>


        </body>
</html>
